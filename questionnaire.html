<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catch the Falling Leaf ‚Äì Mobile Controls Added</title>
  <style>
    /* Styles */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 1rem;
      background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
      display: flex; justify-content: center;
    }
    main {
      max-width: 700px; width: 100%;
      background: white; border-radius: 12px; padding: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.1);
      text-align: center;
    }
    h2 {
      color: #1e40af;
      font-weight: 700;
      margin-bottom: 20px;
    }
    canvas {
      background: #c1e1c1;
      border-radius: 12px;
      display: block;
      margin: 0 auto 15px;
    }
    button, a.button-link {
      background: #1e40af;
      color: white;
      border: none;
      padding: 12px 25px;
      font-weight: 700;
      font-size: 1rem;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
      margin: 0 8px 10px 8px;
      text-decoration: none;
      display: inline-block;
    }
    button:hover, a.button-link:hover {
      background: #155799;
    }
    #scoreDisplay, #missedDisplay {
      font-size: 1.2rem;
      font-weight: 600;
      color: #276749;
      margin: 10px 0;
    }
    #controlButtons {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <main>
    <h2>Catch the Falling Leaf üçÇ</h2>
    <canvas id="gameCanvas" width="600" height="350"></canvas>
    <div>Score: <span id="scoreDisplay">0</span></div>
    <div>Missed: <span id="missedDisplay">0</span> / 5</div>
    <div>
      <button id="startBtn">Start Game</button>
      <a href="home.html" class="button-link" id="homeBtn">Home</a>
    </div>
    <!-- Mobile left and right controls -->
    <div id="controlButtons">
      <button id="leftBtn" aria-label="Move Left">‚óÄ Left</button>
      <button id="rightBtn" aria-label="Move Right">Right ‚ñ∂</button>
    </div>
  </main>

  <script>
    // JavaScript Game Code

    // Canvas & Context
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // UI Elements
    const scoreDisplay = document.getElementById('scoreDisplay');
    const missedDisplay = document.getElementById('missedDisplay');
    const startBtn = document.getElementById('startBtn');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    // Basket configuration
    const basketWidth = 100;
    const basketHeight = 20;
    let basketX = (canvas.width - basketWidth) / 2;
    const basketY = canvas.height - basketHeight - 10;

    // Game state variables
    let rightPressed = false;
    let leftPressed = false;
    let leaves = [];
    const leafRadius = 18;
    const leafSpeedStart = 1.5;
    let leafSpeed = leafSpeedStart;
    let score = 0;
    let missed = 0;
    const maxMissed = 5;
    let gameRunning = false;
    let animationFrameId;
    let leafInterval;

    // Draw basket function
    function drawBasket() {
      ctx.fillStyle = '#2d6a4f';
      ctx.fillRect(basketX, basketY, basketWidth, basketHeight);
      ctx.fillStyle = '#1e40af';
      ctx.fillRect(basketX + 10, basketY - 10, basketWidth - 20, 10);
    }

    // Draw falling leaf
    function drawLeaf(leaf) {
      ctx.beginPath();
      const gradient = ctx.createRadialGradient(leaf.x, leaf.y, 4, leaf.x, leaf.y, leafRadius);
      gradient.addColorStop(0, '#fbbf24');
      gradient.addColorStop(1, '#c2410c');
      ctx.fillStyle = gradient;
      ctx.arc(leaf.x, leaf.y, leafRadius, 0, Math.PI * 2);
      ctx.fill();
    }

    // Create new leaf at random x position at top
    function createLeaf() {
      const x = Math.random() * (canvas.width - 2 * leafRadius) + leafRadius;
      leaves.push({x: x, y: -leafRadius, caught: false});
    }

    // Game draw loop
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBasket();

      leaves.forEach((leaf, idx) => {
        if (!leaf.caught) {
          leaf.y += leafSpeed;
          // Leaf caught by basket?
          if (
            leaf.y + leafRadius >= basketY &&
            leaf.x > basketX &&
            leaf.x < basketX + basketWidth
          ) {
            score++;
            leaf.caught = true;
            scoreDisplay.textContent = score;
            if (score % 5 === 0) {
              leafSpeed += 0.3;
            }
          }
          // Leaf missed?
          else if (leaf.y - leafRadius > canvas.height && !leaf.caught) {
            missed++;
            missedDisplay.textContent = missed;
            leaf.caught = true;
            if (missed >= maxMissed) {
              alert('Game Over! You missed 5 leaves.');
              stopGame();
              return;
            }
          }

          if (leaf.y - leafRadius > canvas.height || leaf.caught) {
            leaves.splice(idx, 1);
          } else {
            drawLeaf(leaf);
          }
        }
      });

      // Basket movement based on button/key states
      if (rightPressed && basketX < canvas.width - basketWidth) basketX += 6;
      if (leftPressed && basketX > 0) basketX -= 6;

      if (gameRunning) animationFrameId = requestAnimationFrame(draw);
    }

    // Keyboard event handlers
    function keyDownHandler(e) {
      if (e.key === 'Right' || e.key === 'ArrowRight') rightPressed = true;
      if (e.key === 'Left' || e.key === 'ArrowLeft') leftPressed = true;
    }
    function keyUpHandler(e) {
      if (e.key === 'Right' || e.key === 'ArrowRight') rightPressed = false;
      if (e.key === 'Left' || e.key === 'ArrowLeft') leftPressed = false;
    }

    // Start game setup
    function startGame() {
      if (gameRunning) return;
      gameRunning = true;
      score = 0;
      missed = 0;
      leafSpeed = leafSpeedStart;
      scoreDisplay.textContent = score;
      missedDisplay.textContent = missed;
      leaves = [];
      basketX = (canvas.width - basketWidth) / 2;

      leafInterval = setInterval(() => {
        if (!gameRunning) clearInterval(leafInterval);
        else createLeaf();
      }, 900);

      draw();
    }

    // Stop the game
    function stopGame() {
      gameRunning = false;
      clearInterval(leafInterval);
      cancelAnimationFrame(animationFrameId);
      leftPressed = false;
      rightPressed = false;
    }

    // Mobile button handlers to simulate keyboard presses
    function buttonPress(isLeft) {
      if (isLeft) leftPressed = true;
      else rightPressed = true;
    }
    function buttonRelease(isLeft) {
      if (isLeft) leftPressed = false;
      else rightPressed = false;
    }

    // Add event listeners for mobile buttons (touch and click)
    leftBtn.addEventListener('touchstart', e => { e.preventDefault(); buttonPress(true); });
    leftBtn.addEventListener('touchend', e => { e.preventDefault(); buttonRelease(true); });
    leftBtn.addEventListener('mousedown', e => { e.preventDefault(); buttonPress(true); });
    leftBtn.addEventListener('mouseup', e => { e.preventDefault(); buttonRelease(true); });
    leftBtn.addEventListener('mouseleave', e => { e.preventDefault(); buttonRelease(true); });

    rightBtn.addEventListener('touchstart', e => { e.preventDefault(); buttonPress(false); });
    rightBtn.addEventListener('touchend', e => { e.preventDefault(); buttonRelease(false); });
    rightBtn.addEventListener('mousedown', e => { e.preventDefault(); buttonPress(false); });
    rightBtn.addEventListener('mouseup', e => { e.preventDefault(); buttonRelease(false); });
    rightBtn.addEventListener('mouseleave', e => { e.preventDefault(); buttonRelease(false); });

    // Event listeners for keyboard control
    document.addEventListener('keydown', keyDownHandler);
    document.addEventListener('keyup', keyUpHandler);

    // Start game button click event
    startBtn.addEventListener('click', startGame);
  </script>
</body>
</html>
